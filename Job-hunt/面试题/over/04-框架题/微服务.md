## 什么是微服务

- 一种云原生架构方法，其中单个应用程序由许多松散耦合且可独立部署的较小组件或服务组成
- 这些服务通常
  - 有自己的堆栈，包括数据库和数据模型；
  - 通过REST API，事件流和消息代理的组合相互通信；
  - 它们是按业务能力组织的，分隔服务的线通常称为有界上下文
- 好处
  - 可以更轻松地更新代码。
  - 团队可以为不同的组件使用不同的堆栈。
  - 组件可以彼此独立地进行缩放，从而减少了因必须缩放整个应用程序而产生的浪费和成本，因为单个功能可能面临过多的负载。
- 云原生
  - 云原生是基于分布部署和统一运管的分布式云 ，以容器、微服务、DevOps等技术为基础建立的一套云技术产品体系
  - 优点
    - 云原生应用也就是面向“云”而设计的应用，在使用云原生技术后，开发者无需考虑底层的技术实现，可以充分发挥云平台的弹性和分布式优势，实现快速部署、按需伸缩、不停机交付等

## 微服务架构优点

- 优点
  - 独立开发 – 所有微服务都可以根据各自的功能轻松开发  
  - 独立部署 – 基于其服务，可以在任何应用程序中单独部署它们  
  - 故障隔离 – 即使应用程序的一项服务不起作用，系统仍可继续运行  
  - 混合技术堆栈 – 可以使用不同的语言和技术来构建同一应用程序的不同 服务  粒度缩放 – 单个组件可根据需要进行缩放，无需将所有组件缩放在一起

## 微服务开发优缺点

- 优点
  - 解耦 – 系统内的服务很大程度上是分离的。因此，整个应用程序可以轻 松构建，更改和扩展  
  - 组件化 – 微服务被视为可以轻松更换和升级的独立组件  
  - 业务能力 – 微服务非常简单，专注于单一功能  
  - 自治 – 开发人员和团队可以彼此独立工作，从而提高速度  持续交付 – 通过软件创建，测试和批准的系统自动化，允许频繁发布软 件  
  - 责任 – 微服务不关注应用程序作为项目。相反，他们将应用程序视为他 们负责的产品  
  - 分散治理 – 重点是使用正确的工具来做正确的工作。这意味着没有标准 化模式或任何技术模式。开发人员可以自由选择最有用的工具来解决他们的问题  
  - 敏捷 – 微服务支持敏捷开发。任何新功能都可以快速开发并再次丢弃
- 缺点
  - 内部远程调用增加了延迟
  - 增加了配置、通信等工作量
  - 分布式数据一致性要提供更多保障

## 微服务组件

- 常用组件
  - 客户端 – 来自不同设备的不同用户发送请求。  
  - 身份提供商 – 验证用户或客户身份并颁发安全令牌。  
  - API 网关 – 处理客户端请求。  
  - 静态内容 – 容纳系统的所有内容。  
  - 管理 – 在节点上平衡服务并识别故障。  
  - 服务发现 – 查找微服务之间通信路径的指南。  
  - 内容交付网络 – 代理服务器及其数据中心的分布式网络。  
  - 远程服务 – 启用驻留在 IT 设备网络上的远程访问信息

## 开发时的挑战

- 挑战
  - 自动化组件：难以自动化，因为有许多较小的组件。因此，对于每个组件， 我们必须遵循 Build，Deploy 和 Monitor 的各个阶段。  
  - 易感性：将大量组件维护在一起变得难以部署，维护，监控和识别问题。 它需要在所有组件周围具有很好的感知能力。 
  -  配置管理：有时在各种环境中维护组件的配置变得困难。  
  - 调试：很难找到错误的每一项服务。维护集中式日志记录和仪表板以调试 问题至关重要。

## 什么是SpringCloud

- Spring Cloud 为开发人员提供了快速构建分布 式系统中一些常见模式的工具（例如配置管理，服务发现，断路器，智能路由， 领导选举，分布式会话，集群状态）
- 解决的问题
  - 与分布式系统相关的复杂性 – 包括网络问题，延迟开销，带宽问题，安 全问题。 
  -  处理服务发现的能力 – 服务发现允许集群中的进程和服务找到彼此并进 行通信。  
  - 解决冗余问题 – 冗余问题经常发生在分布式系统中。  
  - 负载平衡 – 改进跨多个计算资源（例如计算机集群，网络链接，中央处 理单元）的工作负载分布。  减少性能问题 – 减少因各种操作开销导致的性能问题。

## 分布式事务

- 概念

  - 指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上

- 方式

  - 两阶段提交方案
    -  阶段一：开始向事务涉及到的全部资源发送提交前信息。此时，事务涉及到的资源还有最后一次机会来异常结束事务。如果任意一个资源决定异常结束事务，则整个事务取消，不会进行资源的更新
    - 阶段二：只在阶段一没有异常结束的时候才会发生。此时，所有能被定位和单独控制的资源管理器都将开始执行真正的数据更新
    -  在分布式事务两阶段提交协议中，有一个主事务管理器负责充当分布式事务协调器的角色。事务协调器负责整个事务并使之与网络中的其他事务管理器协同工作
    - 优缺点
      - 优点
        - 比较适合单块应用里，跨多个库的分布式事务，
      - 缺点
        - 依赖于数据库层面来搞定复杂的事务，效率很低，绝对不适合高并发的场景
        - 很少用，一般来说某个系统内部如果出现跨多个库的操作，是不合规的
        - 微服务架构下也不允许直连别的服务的库，否则很难治理

  

  - Try、Confirm、Cancel方案
    - 三阶段
      - Try：做业务检查(一致性)及资源预留(隔离)
      - Confirm ：确认提交，Try阶段所有分支事务执行成功后开始执行Confirm
      - 